% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_asr_direct.R
\name{calculate_asr_direct}
\alias{calculate_asr_direct}
\title{Calculate Age-Standardised Rates with Confidence Intervals}
\usage{
calculate_asr_direct(
  .df,
  conf_level = 0.95,
  multiplier = 1e+05,
  ci_method = "gamma",
  warn_small_cases = TRUE
)
}
\arguments{
\item{.df}{A data frame containing age-specific case counts, population data,
and standard population weights. Must contain the following columns:
\itemize{
\item \strong{age_group}: Age group labels
\item \strong{events}: Number of events/cases in each age group (integer). For incidence:
new cases over time. For prevalence: individuals with condition at a point in time.
\item \strong{person_years}: Person-years of follow-up (incidence) or population size
(prevalence) in each age group (numeric). For prevalence studies, use the
total number of individuals examined/surveyed.
\item \strong{standard_pop}: Standard population weights for each age group (numeric)
}}

\item{conf_level}{Confidence level for confidence intervals (default: 0.95)}

\item{multiplier}{Multiplier for rate expression (default: 100000 for rates
per 100,000). Use 100 for prevalence studies to express results as percentages.}

\item{ci_method}{Character string specifying the confidence interval
calculation method. Options are "gamma" (default) or "byars". The gamma
method uses the gamma distribution approach (consistent with
\href{https://CRAN.R-project.org/package=epitools}{epitools}), while the Byar's
method uses Byar's approximation with Dobson adjustment (consistent with
\href{https://CRAN.R-project.org/package=PHEindicatormethods}{PHEindicatormethods}).
Both methods are statistically valid; differences are typically minimal.}

\item{warn_small_cases}{Logical. If TRUE (default), warns when age groups
have zero or < 5 cases which may lead to unstable rate estimates, and warns
when age groups with zero person-years are automatically excluded. Set to
FALSE to suppress these data quality warnings. Consider wider age groups
for more stable results.}
}
\value{
A tibble containing:
\itemize{
\item \strong{crude_rate}: Crude incidence rate
\item \strong{crude_rate_scaled}: Crude rate multiplied by multiplier
\item \strong{asr}: Age-standardised incidence rate
\item \strong{asr_scaled}: ASR multiplied by multiplier
\item \strong{ci_lower}: Lower confidence interval bound for ASR
\item \strong{ci_upper}: Upper confidence interval bound for ASR
\item \strong{ci_lower_scaled}: Lower CI multiplied by multiplier
\item \strong{ci_upper_scaled}: Upper CI multiplied by multiplier
\item \strong{conf_level}: Confidence level used
\item \strong{total_events}: Total number of events across all age groups
\item \strong{total_person_years}: Total person-years across all age groups
\item \strong{age_specific_data}: Data frame with age-specific rates and details
}
}
\description{
This function calculates age-standardised rates using the direct
standardisation method with confidence intervals. It can be used for both
incidence rates (events over time) and prevalence rates (cross-sectional
data). The gamma method is preferred for confidence intervals as it naturally
prevents negative bounds and is the standard approach in epidemiological
literature.
}
\details{
The function uses the gamma distribution method for confidence
interval calculation, which is the standard approach in epidemiological
software like epitools. This method naturally prevents negative confidence
interval bounds and is appropriate for rate data.

The direct standardisation method calculates ASR as: ASR = Σ(w_i × r_i)
where w_i are standardised weights and r_i are age-specific rates

\strong{Incidence vs Prevalence:}
\itemize{
\item \strong{Incidence rates}: Use person-years of follow-up in denominator, typically expressed per 100,000
\item \strong{Prevalence rates}: Use total individuals examined in denominator, typically expressed as percentages (set multiplier = 100)
}

\strong{Age Grouping Considerations:}
\itemize{
\item Age groups with zero person-years are automatically excluded from calculation
\item Zero cases are allowed but may indicate very low incidence or small populations
\item Age groups with < 5 cases produce less stable rate estimates and wider confidence intervals
\item Consider wider age groups if many strata have very few cases
\item The function balances statistical stability with age-specific precision
\item Use \code{warn_small_cases = FALSE} to suppress data quality warnings
}
}
\examples{
# Example 1: Incidence rates (per 100,000)
incidence_data <- data.frame(
  age_group = c("0-19", "20-39", "40-59", "60-79", "80+"),
  events = c(5L, 25L, 150L, 300L, 80L),
  person_years = c(20000, 25000, 22000, 15000, 3000),
  standard_pop = c(35000, 25000, 20000, 15000, 5000)
)

# Calculate age-standardised incidence rate
incidence_result <- calculate_asr_direct(.df = incidence_data)
print(incidence_result$asr_scaled)  # ASR per 100,000

# Example 2: Prevalence rates (as percentages)
prevalence_data <- data.frame(
  age_group = c("18-29", "30-49", "50-69", "70+"),
  events = c(12L, 45L, 98L, 67L),  # Individuals with condition
  person_years = c(1200, 1500, 1400, 800),  # Individuals surveyed
  standard_pop = c(2435, 3847, 2603, 763)
)

# Calculate age-standardised prevalence (use multiplier = 100 for percentages)
prevalence_result <- calculate_asr_direct(.df = prevalence_data, multiplier = 100)
print(paste("Prevalence:", round(prevalence_result$asr_scaled, 2), "\%"))

}
\references{
Breslow, N. E., & Day, N. E. (1987). Statistical methods in
cancer research. Volume II--The design and analysis of cohort studies. IARC
scientific publications, (82), 1-406.
}
